# 性能优化策略

**日期：** 2026-02-19
**作者：** financial_helper 团队

---

## 12. 性能优化策略

### 12.1 缓存策略

| 层级 | 缓存内容 | 缓存时长 |
|------|---------|---------|
| Redis | 股票基础信息 | 1天 |
| Redis | K线数据（日级） | 1小时 |
| Redis | LLM 响应（相同输入） | 按需 |
| 本地缓存 | 配置、字典数据 | 进程级 |

### 12.2 异步处理

- **IO 密集型**：
  - 数据抓取：异步 HTTP 客户端
  - LLM 调用：异步 API 调用
- **耗时任务**：
  - 批量分析：Celery 异步任务
  - 报告生成：后台任务 + 回调通知

### 12.3 数据库优化

- **PostgreSQL**：
  - 合理索引（股票代码、日期等高频查询字段）
  - 分区表（按时间分区历史数据）
  - 连接池配置
- **InfluxDB**：
  - 合理的保留策略（RP）
  - 持续查询（CQ）预聚合
- **Neo4j**：
  - 索引常用查询属性
  - 批量导入优化

### 12.4 LLM 成本优化

- **缓存**：相同输入直接返回缓存结果
- **模型选择**：简单任务使用便宜模型
- **Token 优化**：
  - 智能截断长上下文
  - 使用更高效的提示词
- **批量处理**：批量调用合并请求
