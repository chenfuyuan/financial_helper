# A股投资顾问系统 - 依赖关系与约束

**日期：** 2026-02-19
**作者：** financial_helper 团队

---

## 4. 依赖关系图

```
┌───────────────────────────────────────────────────────────────────────────┐
│                               接口层 API                                    │
└───────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌───────────────────────────────────────────────────────────────────────────┐
│  COORDINATOR (协调器) ────────────────────────────────────────────────────┐
│    │                                (仅编排流程，不碰数据，不调LLM)         │
│    ├─▶ RESEARCH (研究)  ─────────┐                                      │
│    ├─▶ DEBATE (辩论)    ─────────┤                                      │
│    └─▶ JUDGE (决策)     ─────────┤                                      │
│                                    │                                      │
└────────────────────────────────────┼──────────────────────────────────────┘
                                     │
         ┌───────────────────────────┼───────────────────────────┐
         │                           │                           │
         ▼                           ▼                           ▼
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│ MARKET_INSIGHT  │      │ KNOWLEDGE_CENTER│      │  LLM_GATEWAY    │
│  (市场洞察)      │      │   (知识中心)     │      │   (LLM网关)     │
│                 │      │                 │      │ (仅调用LLM)      │
└─────────────────┘      └─────────────────┘      └─────────────────┘
         │                           │                           │
         └───────────────┬───────────┴───────────┬───────────────┘
                         │                       │
                         ▼                       ▼
                ┌─────────────────┐   ┌─────────────────┐
                │  RESEARCH       │   │   DEBATE       │
                │  (研究模块)     │   │   (辩论模块)     │
                │  - 宏观分析     │   └─────────────────┘
                │  - 财务分析     │           │
                │  - 估值分析     │           ▼
                │  - 催化剂分析   │   ┌─────────────────┐
                │  - 技术分析     │   │   JUDGE        │
                │  - 行业分析     │   │   (决策模块)     │
                └─────────────────┘   └─────────────────┘
                         │
                         ▼
                ┌─────────────────┐
                │ DATA_ENGINEERING│
                │  (数据工程)      │
                └─────────────────┘
                         │
                         ▼
                ┌─────────────────┐
                │   FOUNDATION    │
                │  (基础设施层)    │
                └─────────────────┘
```

**关键依赖规则：**
1. FOUNDATION 不依赖任何其他模块
2. DATA_ENGINEERING 只依赖 FOUNDATION
3. LLM_GATEWAY 只依赖 FOUNDATION，不依赖 DATA_ENGINEERING，不进行提示词管理
4. **COORDINATOR 特殊约束**：
   - 不依赖 DATA_ENGINEERING（业务模块自行获取数据）
   - 不依赖 LLM_GATEWAY（业务模块自行调用 LLM）
   - 只依赖 RESEARCH、DEBATE、JUDGE 进行流程编排
5. 业务模块（RESEARCH、DEBATE、JUDGE）按需依赖 DATA_ENGINEERING 和 LLM_GATEWAY

---

## 7. 关键约束

### 7.1 模块边界约束

| 模块 | 禁止操作 | 必须操作 |
|------|---------|---------|
| FOUNDATION | 访问业务数据库、包含业务逻辑、调用上层模块 | 提供基础技术服务（crawler、cache、notification） |
| DATA_ENGINEERING | 直接调用 LLM、访问图数据库、包含分析逻辑 | 存储最完整数据、提供标准化数据接口 |
| LLM_GATEWAY | 直接调用外部 API、访问业务数据库、包含分析逻辑、依赖 DATA_ENGINEERING、进行提示词管理 | 只提供 LLM 调用能力、管理多模型接入 |
| KNOWLEDGE_CENTER | 直接调用 LLM（应通过 llm_gateway） | 提供知识图谱查询和推理 |
| COORDINATOR | 包含具体分析逻辑、直接调用外部 API、直接访问 DATA_ENGINEERING、直接调用 LLM_GATEWAY | 只进行流程编排（LangGraph） |
| RESEARCH | 直接调用外部 LLM API、包含决策逻辑 | 从 DATA_ENGINEERING 获取数据、从 LLM_GATEWAY 调用 LLM、生成多维度研究报告 |
| DEBATE | 直接调用外部 LLM API、做出最终决策 | 从 KNOWLEDGE_CENTER 获取知识、从 LLM_GATEWAY 调用 LLM、进行多空辩论 |
| JUDGE | 直接调用外部 LLM API | 从 KNOWLEDGE_CENTER 获取知识、从 LLM_GATEWAY 调用 LLM、做出最终决策 |

### 7.2 数据约束

- DATA_ENGINEERING 存储最完整的数据，其他模块按需获取，不重复存储
- 数据访问统一通过 DATA_ENGINEERING 提供的接口
- LLM_GATEWAY 不依赖 DATA_ENGINEERING，保持独立
- COORDINATOR 不直接访问数据，由业务模块（RESEARCH 等）自行访问

### 7.3 LLM 约束

- LLM_GATEWAY 只提供调用能力，不进行提示词管理
- 业务提示词由各业务模块（RESEARCH、DEBATE、JUDGE）管理
- 所有 LLM 调用统一通过 LLM_GATEWAY
- COORDINATOR 不直接调用 LLM，由业务模块自行调用
