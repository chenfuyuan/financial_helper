## 1. 分析现有代码和依赖

- [x] 1.1 分析当前 SyncConceptsHandler 的实现逻辑
- [x] 1.2 检查 ConceptRepository 和 ConceptStockRepository 的批量操作方法
- [x] 1.3 确认 StockBasicRepository 的查询方法是否满足需求
- [x] 1.4 检查现有的测试用例，了解预期行为

## 2. 实现批量操作方法

- [x] 2.1 在 ConceptRepository 中添加或完善 save_many 方法
- [x] 2.2 在 ConceptStockRepository 中添加或完善 save_many方法  
- [x] 2.3 在 ConceptStockRepository 中添加或完善 delete_many 方法
- [x] 2.4 为批量操作方法编写单元测试

## 3. 重构 SyncConceptsHandler 主逻辑

- [x] 3.1 修改 handle 方法，实现全量同步准备逻辑
- [x] 3.2 实现题材级别的概念 upsert 逻辑（每个题材独立事务）
- [x] 3.3 实现题材级别的股票关系同步逻辑（在同一事务中）
- [x] 3.4 实现题材级别的延迟清理逻辑（删除过时股票关系）
- [x] 3.5 实现全局清理逻辑（删除过时概念，每个概念独立事务）

## 4. 添加详细日志记录

- [x] 4.1 在关键步骤添加结构化日志
- [x] 4.2 添加批量操作进度日志
- [x] 4.3 添加性能监控日志（处理时间、内存使用）
- [x] 4.4 添加错误处理和异常日志

## 5. 性能优化

- [x] 5.1 实现分批处理机制，避免内存溢出
- [x] 5.2 优化数据库查询，减少 N+1 问题
- [x] 5.3 添加配置项支持（批次大小、超时设置等）
- [x] 5.4 实现内存使用监控和优化

## 6. 更新测试用例

- [x] 6.1 修改现有集成测试，适配新的全量同步逻辑
- [x] 6.2 添加批量操作方法的单元测试
- [x] 6.3 添加全量同步流程的集成测试
- [x] 6.4 添加性能测试和压力测试

## 7. 文档和验证

- [x] 7.1 更新相关文档字符串和注释
- [x] 7.2 验证 API 接口行为保持不变
- [x] 7.3 运行完整的 CI/CD 流水线
- [x] 7.4 进行端到端测试验证
